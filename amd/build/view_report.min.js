define(["jquery","core/templates","core/notification","core/ajax"],function(a,b,c,d){return{init:function(){var b=this;a(document).ready(function(){a("#id_filter_subcategories").val()>0&&b.getCourses(),a(document).on("change","#id_filter_subcategories",function(a){a.preventDefault(),b.getCourses()});a("input[name=defaultfilter]").val();a("#id_prefsave").click(function(b){b.preventDefault();var e=a(this).closest("form"),f=a("input[name=prefname]"),g=a("select[name=presaved]"),h=f.data("id"),i=a("input[name=id]").val(),j=0;a("input[name=defaultfilter]").is(":checked")&&(j=1);var k=f.val(),l=[],m=["id","courseid","embedded","sesskey","_qf__report_edit_form","mform_isexpanded_id_general","prefname","presaved","defaultfilter"],n=e.serializeArray();a.each(n,function(b,c){a.inArray(c.name,m)===-1&&l.push(c)}),d.call([{methodname:"block_configurable_reports_update_filter_preferences",args:{id:h,reportid:i,name:k,parameters:JSON.stringify(l),defaultfilter:j}}])[0].done(function(b){1==b?(g.append('<option value="" selected="selected">'+k+"</option>"),a("#id_presaved").show().removeAttr("hidden")):c.alert(null,"Error!")}).fail(c.exception)}),a("#id_presaved").change(function(){var b=a(this).val();b>0&&d.call([{methodname:"block_configurable_reports_get_filter_preferences",args:{id:b}}])[0].done(function(b){if(b===!1)c.alert(null,"Error!");else{var d=JSON.parse(b.filter);a.each(d,function(b,c){var d=a("#id_"+c.name);d.length>0&&d.val(c.value)})}}).fail(c.exception)})})},getCourses:function(){var b=this,c=a("#id_filter_courses").val();a("#id_filter_courses").html("");var d=a("#id_filter_subcategories").val();a.ajax({type:"GET",url:"get_courses_in_category.php?category="+d,success:function(a){b.replaceTemplate("#id_filter_courses","block_configurable_reports/courses",a,c)}})},replaceTemplate:function(d,e,f,g){b.render(e,f).done(function(c,e){a(d).html(c),b.runTemplateJS(e),g&&0!==a("#id_filter_courses option[value='"+g+"']").length&&a("#id_filter_courses").val(g)}).fail(c.exception)}}});